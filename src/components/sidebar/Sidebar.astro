---
import Sitemap from './Sitemap.astro'
import { Icon } from 'astro-icon/components'
---

<input id="sidebar-toggle" type="checkbox" class="hidden" transition:persist />
<div
  id="sidebar-container"
  class="relative flex-shrink-0
        overflow-y-auto overflow-x-hidden
        text-zinc-950 bg-zinc-300 transition-all"
  transition:persist
>
  <nav
    id="sidebar"
    class="text-sm font-medium
  absolute top-0 h-[calc(100vh_-_var(--header-height))]"
  >
    <label
      id="sidebar-hamburger"
      for="sidebar-toggle"
      class="fixed z-10
        flex items-center justify-end
        px-3
        text-right text-2xl
        select-none cursor-pointer
        border-b-2 border-zinc-200
        bg-zinc-300 hover:bg-blue-500"
    >
      <Icon name="ic:sharp-menu" />
    </label>

    <div id="sidebar-content" class="pl-4 py-1">
      <Sitemap />
    </div>
  </nav>
</div>

<style is:global>
  :root {
    --collapsed-width: 3rem;
    --expanded-width: 20rem;
    --sidebar-hamburger-height: 2rem;
    --sidebar-width: var(--expanded-width);
  }

  #sidebar {
    min-width: var(--collapsed-width);
    margin-top: var(--header-height);
  }
  #sidebar-hamburger {
    height: var(--sidebar-hamburger-height);
    width: var(--sidebar-width);
  }

  #sidebar-container {
    width: var(--sidebar-width);
    scrollbar-color: #a1a1aa transparent;
    scrollbar-width: thin;
    scrollbar-gutter: stable;
  }
  #sidebar-content {
    margin-top: var(--sidebar-hamburger-height);
    width: var(--sidebar-width);
    display: block;
  }
  #sidebar-toggle:not(:checked)
    + #sidebar-container
    > #sidebar
    > #sidebar-content {
    display: none;
  }

  #sidebar-toggle:not(:checked) ~ #sidebar-container ~ #content,
  #sidebar-toggle:not(:checked) ~ #sidebar-container {
    --sidebar-width: var(--collapsed-width);
  }

  #sidebar-toggle:checked + nav > label:not(:hover) {
    @apply bg-zinc-400;
  }

  @media not all and (min-width: 768px) {
    #sidebar-container {
      --sidebar-width: 100vw;
      @apply bg-transparent max-md:fixed
        max-md:right-0
        max-md:bottom-0
        max-md:top-0;
      z-index: 40;
    }
    #sidebar-toggle:checked ~ #content {
      @apply h-screen;
    }
    #sidebar-toggle:checked ~ #sidebar-container {
      @apply bg-zinc-200;
    }
  }
</style>
